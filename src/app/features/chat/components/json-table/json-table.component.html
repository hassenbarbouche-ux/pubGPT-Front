<mat-card class="json-table-card">
  <mat-card-content>
    <div class="table-container">
      <table mat-table [dataSource]="visibleData" class="json-table">
        <!-- Générer dynamiquement les colonnes -->
        <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
          <th mat-header-cell *matHeaderCellDef>
            {{ formatColumnName(column) }}
          </th>
          <td mat-cell *matCellDef="let row">
            {{ formatValue(row[column]) }}
          </td>
        </ng-container>

        <!-- Ligne d'en-tête -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

        <!-- Lignes de données -->
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <!-- Bouton Expand/Collapse pour tableaux > 10 lignes -->
    <div class="collapse-section" *ngIf="canCollapse">
      <button mat-button class="collapse-button" (click)="toggleCollapse()">
        <mat-icon>{{ isCollapsed ? 'expand_more' : 'expand_less' }}</mat-icon>
        <span>{{ isCollapsed ? 'Afficher plus' : 'Afficher moins' }} ({{ displayedData.length }} lignes)</span>
      </button>
    </div>

    <!-- Afficher le nombre de résultats -->
    <div class="result-count" *ngIf="tableData.length > 0">
      <span *ngIf="!hasMoreData">{{ tableData.length }} résultat{{ tableData.length > 1 ? 's' : '' }}</span>
      <span *ngIf="hasMoreData">Affichage de {{ displayedData.length }} sur {{ tableData.length }} résultats</span>
    </div>

    <!-- Lien de téléchargement Excel pour les datasets volumineux -->
    <div class="excel-download" *ngIf="hasMoreData">
      <button mat-button class="download-button" (click)="downloadExcel()">
        <mat-icon class="excel-icon">description</mat-icon>
        <span>resultat_spots_2025.xlsx</span>
      </button>
    </div>
  </mat-card-content>
</mat-card>
