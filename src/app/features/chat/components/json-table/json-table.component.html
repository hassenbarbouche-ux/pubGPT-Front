<mat-card class="json-table-card">
  <mat-card-content>
    <div class="table-container">
      <table mat-table [dataSource]="visibleData" class="json-table">
        <!-- Colonne pour les numéros de ligne -->
        <ng-container matColumnDef="rowNumber">
          <th mat-header-cell *matHeaderCellDef class="row-number-header"></th>
          <td mat-cell *matCellDef="let row; let i = index" class="row-number-cell">
            <div class="row-number-badge">{{ getRowNumber(i) }}</div>
          </td>
        </ng-container>

        <!-- Générer dynamiquement les colonnes -->
        <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
          <th mat-header-cell *matHeaderCellDef>
            {{ formatColumnName(column) }}
          </th>
          <td mat-cell *matCellDef="let row">
            {{ formatValue(row[column]) }}
          </td>
        </ng-container>

        <!-- Ligne d'en-tête -->
        <tr mat-header-row *matHeaderRowDef="displayedColumnsWithRowNumber"></tr>

        <!-- Lignes de données -->
        <tr mat-row *matRowDef="let row; columns: displayedColumnsWithRowNumber;"></tr>
      </table>
    </div>

    <!-- Bouton Expand/Collapse pour tableaux > 10 lignes -->
    <div class="collapse-section" *ngIf="canCollapse">
      <button mat-stroked-button class="collapse-button" (click)="toggleCollapse()">
        <mat-icon>more_horiz</mat-icon>
        <span>{{ isCollapsed ? 'Afficher Plus' : 'Afficher Moins' }}</span>
      </button>
    </div>

    <!-- Lien de téléchargement CSV pour les datasets volumineux -->
    <div class="csv-download" *ngIf="hasMoreData || tableData.length > 0">
      <button mat-button class="download-button" (click)="downloadCSV()">
        <mat-icon class="csv-icon">description</mat-icon>
        <span>Télécharger CSV</span>
      </button>
    </div>
  </mat-card-content>
</mat-card>
